# 项目所有者指南

> 版本：V2.13

[TOC]

本指南面向项目所有者。本文解释了Gerrit 提供的多种自定义项目工作流程的可能性。

## 什么是项目所有者？

作为项目所有者意味着你拥有 Gerrit 中的一个项目。从技术上来说就是在项目的 `refs/*` 引用上具有 Owner 访问权限。作为项目所有者，你有权编辑访问控制列表和项目的设置。同时这也意味着你应当熟悉这些设置，这样你才能使设置符合项目的需要。

作为项目所有者意味着需对项目的管理负责。这要求你比一般用户具备更深刻的 Gerrit 知识。一般来说，一个团队中应该有 2 到 3 名具备足够 Git/Gerrit 知识水平的项目所有者。团队中的所有人都是项目所有者的做法一般来说没什么意义。对于普通的团队成员而言，作为提交者或贡献者就已经足够了。

## 访问权限

作为项目所有者，你可以编辑项目的访问控制列表。这就允许你将项目的权限分配给不同的用户组。

Gerrit 提供了丰富的权限种类，可以对谁能在项目上做什么进行非常细粒度的控制。访问控制是 Gerrit 最强大的特性之一，但也是一个复杂的话题。本指南仅强调访问控制最重要的方面，[访问控制](./access-control.md)一章详细解释了所有细节。

### 编辑访问权限

要查看项目的访问权限：

- 打开 Gerrit 网页
- 点击 `Projects` -> `List` 目录项
- 在项目列表中找到你的项目并单击
- 点击 `Access` 目录项

通过点击 `Edit` 按钮即可编辑访问权限，然后你可以点击 `Save Changes` 按钮保存修改。你也可以选择性地提供一个 提交信息（Commit Message）来解释改变权限的原因。

访问权限以名为 `refs/meta/config` 的特殊分支保存在项目的 Git 仓库中。在这个分支中有一个 包含了访问权限的`project.config` 文件 。更过关于这个存储格式的信息可以在[项目配置文件格式](./config-project-config.md)一章查看。重要的是要知道，通过查看 `refs/meta/config` 分支上 `project.config` 文件的历史记录，你可以随时查看访问权限是怎么变化的以及由谁更改。如果提供了良好的提交消息，你还可以从历史记录中查看修改访问权限的原因。

如果为 Gerrit 服务器配置了 git 浏览器（如 gitweb ），那么你可以在 Web UI 中找到指向 `project.config` 文件历史记录的链接。否则，你可以在本地查看历史记录。如果已克隆仓库，则可以通过执行以下命令来执行此操作：

```console
  $ git fetch origin refs/meta/config:config
  $ git checkout config
  $ git log project.config
```

非项目所有者仍可以通过单击 `Save for Review` 按钮来编辑访问权限并向项目所有者提出修改建议。这将创建一个新的变更，其中包含可由项目所有者批准的访问权限修改。项目所有者将自动添加为此更改的审阅者，以便他们通过电子邮件获得相关信息。

### 继承

通常，当一个新项目在 Gerrit 中创建时，它就已经拥有一些从父项目继承的访问权限。Gerrit 中的项目按层次结构组织为一个树，以 “All-Projects” 项目为根，所有项目都从该项目继承。每个项目只能有一个父项目，不支持多继承。

当你在 Gerrit Web UI 中查看项目的访问权限时，你只能看到在该项目上定义的访问权限。 要查看继承的访问权限，你必须查看 `Rights Inherit From`下的父项目的链接。

除非将它们定义为 [BLOCK 规则](./access-control.md#block)，否则继承的访问权限可以被覆盖。BLOCK 规则用于限制继承项目的项目所有者覆盖权限的可能性。有了这个，就可以对所有项目实施全局策略。请注意，Gerrit 不会阻止你分配与继承的BLOCK 规则相矛盾的访问权限，但这些访问权限将无效。

如果您负责几个需要相同权限的项目，那么为它们建立一个共同父项目并维护该公共父项目的访问权限是有意义的。只允许 Gerrit 管理员更改项目的父项目。这意味着如果要重新选择父项目，你需要联系 Gerrit 服务器的管理员。 一种方法是在 Web UI 中更改父项目，保存修改以供审阅，并获得经 Gerrit 管理员批准和合并的变更。

### 引用

Gerrit 中的访问权限分配在引用（refs）上。Git中的引用存在于不同的命名空间中，例如：所有的分支（branch）通常存在于 `refs/heads/`下，而所有的标签（tag）则在 `refs/tags/` 下。另外还有一些特殊引用和魔法引用。

访问权限既可以分配在具体的引用如 `refs/heads/master` 上，也可以分配在引用模式和正则表达式上。

以 `/*` 结尾的引用模式描述了一个完整的引用名字空间，比如分配在 `refs/heads/*` 上的访问权限应用到了所有分支上。

正则表达式必须以 `^` 开头，比如分配在 `^refs/heads/rel-.*` 上的访问权限应用到了所有匹配 `rel-*` 的分支上。

### 组

访问权限是分配给组的。有必要了解的是，Gerrit 不但维护自己内部的组，还能支持不同的外部组数据源。Gerrit 内部组可以在 Gerrit Web UI 中通过点击 `Groups` > `List` 项看到。点击一个组，你可以编辑组成员（`Members` 标签卡）和组选项（`General` 标签卡）。

Gerrit 内部组的成员可以是用户，也可以包括其他的组，甚至是外部组。

每一个组都归所有者组所有。只有所有者组的成员才可以管理所拥有的组（分配成员，编辑组选项）。一个组可以拥有自己。这种情况下，组成员，举个例子，就可以添加其他成员到这个组。当你为项目创建新组来为提交者或其他角色分配访问权限时，请确保它们归项目所有者组所有。

组的一个重要设置是选项 `Make group visible to all registered users.`，它定义了非组成员是否可以查看谁是该组的成员。

新的 Gerrit 内部组可以在 `Groups` > `Create New Group` 下创建。这个菜单只有在你有全局能力 [Create Group](./access-control.html#capability_createGroup) 时才可用。

Gerrit 还有一组你可能会觉得有用的[特殊系统组](access-control.html#system_groups)。

外部组在赋予权限时需要加上前缀。比如 [LDAP 组名](access-control.html#ldap_groups)前需加上 `ldap/` 前缀。

如果安装了 [singleusergroup](https://gerrit-review.googlesource.com/admin/repos/plugins%2Fsingleusergroup) 插件，你就可以通过在用户名前面加上前缀 `user/` 或在用户 ID 前面加上前缀 `userid/` 的方式直接将权限赋予用户。

### 常见的访问权限

项目中不同的角色，例如开发者（提交者）或贡献者，需要不同的访问权限。[访问控制](access-control.html#example_roles)章节中描述了为哪个角色分配哪些访问权限的经典示例。

### 代码审查

尽管 Gerrit 的主要功能是代码审查，然而使用代码审查只是可选项，你可以决定只把 Gerrit 当做一个具有访问控制能力的 Git 服务器使用。是否仅允许审查或直接推送取决于项目的访问权限。

要推送提交以进行审核，必须将其推送到 [`refs/for/<branch-name>`](access-control.html#refs_for)。也就是说 Push 访问权限必须分配到 `refs/for/<branch-name>` 上。

要允许绕过代码审查而直接推送，引用 `refs/heads/<branch-name>` 就需要 Push 访问权限。

通过推送审查，您不仅可以启用审核工作流，还可以在合并变更之前从构建服务器获取自动验证。 此外，您可以从Gerrit的合并策略中受益，如果需要，可以在服务器端自动合并/变基提交。 您可以通过在项目上配置提交类型来控制合并策略。 如果您绕过代码检查，则在目标分支的提示已移动的情况下总是需要手动合并/变基。 请记住这一点，如果您因为认为避免审核工作流程的额外复杂性而选择不使用代码审核，但实际上可能并不会更简单。

你也可以启用[推送时自动合并](user-upload.html#auto_merge)，以在直接推送到仓库时自动合并/变基。

